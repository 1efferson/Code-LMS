{% extends "admin/admin_base.html" %}

{% block admin_content %}
<h1 class="text-2xl font-semibold mb-4">Manage Users</h1>

<!-- Search bar -->
<form method="GET" action="{{ url_for('admin.manage_users') }}" class="mb-4 flex items-center gap-2 w-1/2">
    <input type="text" name="q" value="{{ search_query or '' }}" 
           placeholder="Search by name or email..." 
           class="px-3 py-2 border rounded w-full text-sm">
    <button type="submit" class="px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm flex items-center gap-1">
        <i class="fas fa-search"></i> Search
    </button>
</form>

<table class="w-full bg-white shadow rounded-lg overflow-hidden">
    <thead>
        <tr class="bg-gray-100 text-left border-b">
            <th class="px-4 py-3">Name</th>
            <th class="px-4 py-3">Email</th>
            <th class="px-4 py-3">Role</th>
            <th class="px-4 py-3">Admin?</th>
            <th class="px-4 py-3">Update</th>
            <th class="px-4 py-3">Delete</th>
        </tr>
    </thead>

    <tbody>
        {% for user in users %}
        <tr class="border-b hover:bg-gray-50">
            <td class="px-4 py-3">{{ user.name }}</td>
            <td class="px-4 py-3">{{ user.email }}</td>
            <td class="px-4 py-3 capitalize">{{ user.role }}</td>
            <td class="px-4 py-3">
                {% if user.is_admin %}
                    <span class="text-green-600 font-medium text-sm">Yes</span>
                {% else %}
                    <span class="text-gray-500 text-sm">No</span>
                {% endif %}
            </td>
            <td class="px-4 py-3">
                <form action="{{ url_for('admin.update_user_role', user_id=user.id) }}" method="POST" class="flex items-center space-x-3">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <select name="role" class="border rounded px-2 py-1 text-sm">
                        <option value="student" {% if user.role == 'student' %}selected{% endif %}>Student</option>
                        <option value="instructor" {% if user.role == 'instructor' %}selected{% endif %}>Instructor</option>
                    </select>
                    <label class="flex items-center space-x-1 text-sm">
                        <input type="checkbox" name="is_admin" value="1" {% if user.is_admin %}checked{% endif %}>
                        <span>Admin</span>
                    </label>
                    <button type="submit" class="px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700">
                        Save
                    </button>
                </form>
            </td>
            <td class="px-4 py-3">
                {% if user.id == current_user.id %}
                    <span class="text-gray-400 text-sm italic">You</span>
                {% else %}
                    <form action="{{ url_for('admin.delete_user', user_id=user.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this user?');">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-sm">
                            Delete
                        </button>
                    </form>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}
